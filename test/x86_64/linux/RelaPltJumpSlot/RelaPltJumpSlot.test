#------rela.plt.test-------Executable------#
#BEGIN_COMMENT
# Verifies .rela.plt section contains JUMP_SLOT relocations pointing to
# GOTPLTN entries with correct symbol indices for dynamic linker resolution.
#END_COMMENT
#START_TEST
RUN: %clang %clangopts -c %p/Inputs/1.c -o %t.1.o
RUN: %clang %clangopts -c %p/Inputs/2.c -o %t.2.o
RUN: %link %linkopts -shared -o %t.lib2.so %t.2.o
RUN: %link %linkopts -o %t.out %t.1.o %t.lib2.so
RUN: (%readelf -S %t.out; %readelf -r %t.out) | %filecheck %s

#Capture .got.plt section address
CHECK: .got.plt PROGBITS [[#%x,GOTPLT_ADDR:]]
CHECK: .rela.plt

#The offset value for the JUMP_SLOT should be the address of corressponding GOTPLTN entry.
#The first 0x18 bytes are part of GOTPLT0
#Info - first 4 bytes contain the index of the symbol in .dynsym the next 4 bytes are for relocation type
CHECK-DAG: [[#GOTPLT_ADDR+0x18]]{{.*}}00000007{{.*}}R_X86_64_JUMP_SLOT {{.*}}foo + 0
CHECK-DAG: [[#GOTPLT_ADDR+0x20]]{{.*}}00000007{{.*}}R_X86_64_JUMP_SLOT {{.*}}foo2 + 0